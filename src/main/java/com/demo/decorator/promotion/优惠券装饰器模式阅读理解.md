# ä¼˜æƒ åˆ¸è£…é¥°å™¨æ¨¡å¼é˜…è¯»ç†è§£æ–‡æ¡£

## ğŸ“– ä¸šåŠ¡åœºæ™¯ä»‹ç»

åœ¨ç”µå•†ç³»ç»Ÿä¸­ï¼Œä¼˜æƒ åˆ¸æ˜¯ä¸€ç§å¸¸è§çš„è¥é”€å·¥å…·ã€‚ç”¨æˆ·å¾€å¾€å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šå¼ ä¼˜æƒ åˆ¸ï¼Œè€Œä¸”ä¼˜æƒ åˆ¸çš„ç»„åˆé¡ºåºä¼šå½±å“æœ€ç»ˆçš„ä»·æ ¼è®¡ç®—ã€‚è¿™ç§åœºæ™¯éå¸¸é€‚åˆä½¿ç”¨è£…é¥°å™¨æ¨¡å¼æ¥å®ç°ã€‚

### ä¼˜æƒ åˆ¸ç±»å‹
1. **æ»¡å‡åˆ¸**ï¼šæ¶ˆè´¹é‡‘é¢è¾¾åˆ°ä¸€å®šé—¨æ§›åï¼Œå‡å…å›ºå®šé‡‘é¢ï¼ˆå¦‚æ»¡200å‡30ï¼‰
2. **æŠ˜æ‰£åˆ¸**ï¼šæŒ‰ç…§ä¸€å®šæ¯”ä¾‹è¿›è¡ŒæŠ˜æ‰£ï¼ˆå¦‚8.5æŠ˜ï¼‰
3. **æ¯æ»¡å‡åˆ¸**ï¼šæ¯æ»¡è¶³ä¸€å®šé‡‘é¢å°±å‡å…å›ºå®šé‡‘é¢ï¼Œå¯å¤šæ¬¡å åŠ ï¼ˆå¦‚æ¯æ»¡100å‡20ï¼‰
4. **æ— æ¡ä»¶å‡åˆ¸**ï¼šç›´æ¥å‡å…å›ºå®šé‡‘é¢ï¼Œæ— é—¨æ§›è¦æ±‚ï¼ˆå¦‚ç›´æ¥å‡15å…ƒï¼‰

## ğŸ—ï¸ è£…é¥°å™¨æ¨¡å¼åœ¨ä¼˜æƒ åˆ¸ç³»ç»Ÿä¸­çš„åº”ç”¨

### 1. Componentï¼ˆç»„ä»¶æ¥å£ï¼‰
```java
public interface IPromotionStrategy {
    double calculatePrice(double originalPrice);
    String getDescription();
    default double getDiscountAmount(double originalPrice) {
        return originalPrice - calculatePrice(originalPrice);
    }
}
```
- å®šä¹‰äº†ä»·æ ¼è®¡ç®—çš„åŸºæœ¬è¡Œä¸º
- æ‰€æœ‰ä¿ƒé”€ç­–ç•¥éƒ½éœ€è¦å®ç°è¿™ä¸ªæ¥å£

### 2. ConcreteComponentï¼ˆå…·ä½“ç»„ä»¶ï¼‰
```java
public class OriginalPrice implements IPromotionStrategy {
    @Override
    public double calculatePrice(double originalPrice) {
        return originalPrice;  // åŸä»·ï¼Œä¸åšä»»ä½•æŠ˜æ‰£
    }

    @Override
    public String getDescription() {
        return "åŸä»·";
    }
}
```
- ä»£è¡¨æ²¡æœ‰ä½¿ç”¨ä»»ä½•ä¼˜æƒ åˆ¸çš„åŸä»·çŠ¶æ€
- æ˜¯è£…é¥°å™¨æ¨¡å¼çš„åŸºç¡€ï¼Œæ‰€æœ‰ä¼˜æƒ åˆ¸éƒ½åœ¨åŸä»·åŸºç¡€ä¸Šè®¡ç®—

### 3. Decoratorï¼ˆè£…é¥°å™¨åŸºç±»ï¼‰
```java
public abstract class PromotionDecorator implements IPromotionStrategy {
    protected IPromotionStrategy decoratedStrategy;

    public PromotionDecorator(IPromotionStrategy strategy) {
        this.decoratedStrategy = strategy;
    }
}
```
- å®ç°ä¿ƒé”€ç­–ç•¥æ¥å£
- æŒæœ‰ä¸€ä¸ªç­–ç•¥å¯¹è±¡çš„å¼•ç”¨
- **ç®€æ´è®¾è®¡**ï¼šæŠ½è±¡ç±»åªå®šä¹‰å…¬å…±å±æ€§ï¼Œå…·ä½“å®ç°äº¤ç»™å­ç±»
- **ç¬¦åˆè®¾è®¡åŸåˆ™**ï¼šé¿å…ä¸å¿…è¦çš„æŠ½è±¡æ–¹æ³•ï¼ŒèŒè´£åˆ†ç¦»æ›´æ¸…æ™°

**è®¾è®¡ä¼˜åŠ¿ï¼š**
- æŠ½è±¡ç±»ä¸éœ€è¦å¼ºåˆ¶é‡å†™æ¥å£æ–¹æ³•
- å­ç±»ç›´æ¥å®ç°æ¥å£æ–¹æ³•ï¼Œé€»è¾‘æ›´ç›´è§‚
- åŸºç±»ä¸“æ³¨äºæŒæœ‰è¢«è£…é¥°å¯¹è±¡çš„å¼•ç”¨

**ä»£ç ä¼˜åŒ–è¦ç‚¹ï¼š**
- `getDiscountAmount`æ–¹æ³•ä½¿ç”¨ç®€æ´å®ç°ï¼š`return originalPrice - calculatePrice(originalPrice)`
- é¿å…é‡å¤è®¡ç®—å’Œé‡å¤è¾“å‡ºï¼Œä¿æŒä»£ç ç®€æ´æ€§
- è®¡ç®—é€»è¾‘ä¸è¾“å‡ºåˆ†ç¦»ï¼Œç¬¦åˆå•ä¸€èŒè´£åŸåˆ™

### 4. ConcreteDecoratorï¼ˆå…·ä½“è£…é¥°å™¨ï¼‰

#### æ»¡å‡åˆ¸
```java
public class FullReductionCoupon extends PromotionDecorator {
    private final double threshold;    // æ»¡å‡é—¨æ§›
    private final double reduction;    // å‡å…é‡‘é¢

    @Override
    public double calculatePrice(double originalPrice) {
        double inputPrice = decoratedStrategy.calculatePrice(originalPrice);
        if (inputPrice >= threshold) {
            return inputPrice - reduction;
        } else {
            return inputPrice;
        }
    }

    @Override
    public String getDescription() {
        return decoratedStrategy.getDescription() + " + " + String.format("æ»¡%.0få‡%.0f", threshold, reduction);
    }

    @Override
    public double getDiscountAmount(double originalPrice) {
        return originalPrice - calculatePrice(originalPrice);
    }
}
```

#### æŠ˜æ‰£åˆ¸
```java
public class DiscountCoupon extends PromotionDecorator {
    private final double discountRate;  // æŠ˜æ‰£ç‡

    @Override
    public double calculatePrice(double originalPrice) {
        double inputPrice = decoratedStrategy.calculatePrice(originalPrice);
        return inputPrice * discountRate;
    }

    @Override
    public String getDescription() {
        return decoratedStrategy.getDescription() + " + " + String.format("%.1fæŠ˜", discountRate * 10);
    }

    @Override
    public double getDiscountAmount(double originalPrice) {
        return originalPrice - calculatePrice(originalPrice);
    }
}
```

#### æ¯æ»¡å‡åˆ¸
```java
public class TieredFullReductionCoupon extends PromotionDecorator {
    private final double threshold;    // æ¯æ»¡çš„é‡‘é¢é—¨æ§›
    private final double reduction;    // æ¯æ¬¡å‡å…çš„é‡‘é¢

    @Override
    public double calculatePrice(double originalPrice) {
        double inputPrice = decoratedStrategy.calculatePrice(originalPrice);
        int times = (int) (inputPrice / threshold);
        double totalReduction = times * reduction;
        return inputPrice - totalReduction;
    }

    @Override
    public String getDescription() {
        return decoratedStrategy.getDescription() + " + " + String.format("æ¯æ»¡%.0få‡%.0f", threshold, reduction);
    }

    @Override
    public double getDiscountAmount(double originalPrice) {
        return originalPrice - calculatePrice(originalPrice);
    }
}
```

#### æ— æ¡ä»¶å‡åˆ¸
```java
public class DirectReductionCoupon extends PromotionDecorator {
    private final double reduction;    // ç›´æ¥å‡å…é‡‘é¢

    @Override
    public double calculatePrice(double originalPrice) {
        double inputPrice = decoratedStrategy.calculatePrice(originalPrice);
        return Math.max(0, inputPrice - reduction);
    }

    @Override
    public String getDescription() {
        return decoratedStrategy.getDescription() + " + " + String.format("ç›´æ¥å‡%.2få…ƒ", reduction);
    }

    @Override
    public double getDiscountAmount(double originalPrice) {
        return originalPrice - calculatePrice(originalPrice);
    }
}
```

## ğŸ”„ è£…é¥°å™¨é“¾çš„å½¢æˆ

ä¼˜æƒ åˆ¸è£…é¥°å™¨é“¾å¯ä»¥çµæ´»ç»„åˆï¼š

```java
// å¤æ‚ç»„åˆï¼šå…ˆæŠ˜æ‰£ + å†æ¯æ»¡å‡ + å†æ»¡å‡ + æœ€åç›´æ¥å‡
IPromotionStrategy complex = new DirectReductionCoupon(
    new FullReductionCoupon(
        new TieredFullReductionCoupon(
            new DiscountCoupon(new OriginalPrice(), 0.8), 100, 15), 150, 25), 10);
```

**è°ƒç”¨é“¾ï¼š**
```
DirectReductionCoupon.calculatePrice()
    â†“
FullReductionCoupon.calculatePrice()
    â†“
TieredFullReductionCoupon.calculatePrice()
    â†“
DiscountCoupon.calculatePrice()
    â†“
OriginalPrice.calculatePrice()
```

## ğŸ’¡ è®¡ç®—é¡ºåºçš„é‡è¦æ€§

è£…é¥°å™¨æ¨¡å¼ä¸€ä¸ªé‡è¦ç‰¹ç‚¹ï¼š**è®¡ç®—é¡ºåºä¼šå½±å“æœ€ç»ˆç»“æœ**

### ç¤ºä¾‹ï¼š299å…ƒå•†å“ï¼Œ8.5æŠ˜ + æ»¡200å‡30

**æ–¹æ¡ˆ1ï¼šå…ˆæŠ˜æ‰£ï¼Œåæ»¡å‡**
```
åŸä»·ï¼š299å…ƒ
æŠ˜æ‰£åï¼š299 Ã— 0.85 = 254.15å…ƒ
æ»¡å‡åï¼š254.15 - 30 = 224.15å…ƒ
æ€»ä¼˜æƒ ï¼š299 - 224.15 = 74.85å…ƒ (25.0%)
```

**æ–¹æ¡ˆ2ï¼šå…ˆæ»¡å‡ï¼ŒåæŠ˜æ‰£**
```
åŸä»·ï¼š299å…ƒ
æ»¡å‡åï¼š299 - 30 = 269å…ƒ
æŠ˜æ‰£åï¼š269 Ã— 0.85 = 228.65å…ƒ
æ€»ä¼˜æƒ ï¼š299 - 228.65 = 70.35å…ƒ (23.5%)
```

**ç»“è®ºï¼šå…ˆæŠ˜æ‰£æ›´ä¼˜æƒ ï¼**

## ğŸ¯ ä¼˜æƒ åˆ¸ç³»ç»Ÿçš„ä¸šåŠ¡ä¼˜åŠ¿

### 1. çµæ´»çš„ç»„åˆç­–ç•¥
```java
// ç”¨æˆ·å¯ä»¥é€‰æ‹©ä»»æ„ä¼˜æƒ åˆ¸ç»„åˆ
IPromotionStrategy userStrategy = chooseUserCoupons(originalPrice);
```

### 2. åŠ¨æ€çš„è§„åˆ™è°ƒæ•´
```java
// å¯ä»¥æ ¹æ®å•†å“ç±»å‹ã€ç”¨æˆ·ç­‰çº§ç­‰å› ç´ åŠ¨æ€è°ƒæ•´
if (user.isVIP()) {
    userStrategy = new DiscountCoupon(userStrategy, 0.9);  // VIPé¢å¤–9æŠ˜
}
```

### 3. æ˜“äºæ‰©å±•æ–°åˆ¸ç§
```java
// æ–°å¢ä¼˜æƒ åˆ¸ç±»å‹ï¼Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç 
public class ShippingCoupon extends PromotionDecorator {
    // å…è¿è´¹åˆ¸çš„å®ç°
}
```

## ğŸ“Š ä¼ ç»Ÿæ–¹æ¡ˆ vs è£…é¥°å™¨æ¨¡å¼

### ä¼ ç»Ÿç»§æ‰¿æ–¹æ¡ˆ
å¦‚æœä½¿ç”¨ç»§æ‰¿å®ç°ä¼˜æƒ åˆ¸ç»„åˆï¼Œ4ç§ä¼˜æƒ åˆ¸éœ€è¦ 2^4 = 16 ä¸ªå­ç±»ï¼š
- `OriginalPrice`
- `WithFullReduction`
- `WithDiscount`
- `WithTieredFullReduction`
- `WithDirectReduction`
- `WithFullReductionAndDiscount`
- ... ï¼ˆè¿˜æœ‰11ç§ç»„åˆï¼‰

### è£…é¥°å™¨æ¨¡å¼æ–¹æ¡ˆ
åªéœ€è¦ 1 + 1 + 4 = 6 ä¸ªç±»ï¼š
- 1ä¸ªç»„ä»¶æ¥å£ï¼š`IPromotionStrategy`
- 1ä¸ªå…·ä½“ç»„ä»¶ï¼š`OriginalPrice`
- 1ä¸ªè£…é¥°å™¨åŸºç±»ï¼š`PromotionDecorator`
- 4ä¸ªå…·ä½“è£…é¥°å™¨ï¼š4ç§ä¼˜æƒ åˆ¸ç±»å‹

**ç±»æ•°é‡å‡å°‘äº† 62.5%ï¼**

## ğŸ“± å®é™…è¿è¡Œæ•ˆæœ

è¿è¡Œæ¼”ç¤ºç¨‹åº `EcommerceShoppingDemo` çš„è¾“å‡ºç»“æœï¼š

```
=== ç”µå•†è´­ç‰©ä¼˜æƒ åˆ¸è£…é¥°å™¨æ¨¡å¼æ¼”ç¤º ===

å•†å“åŸä»·ï¼š299.00å…ƒ

--- åœºæ™¯1ï¼šå•ç‹¬ä½¿ç”¨å„ç§ä¼˜æƒ åˆ¸ ---
1. åŸä»·ç­–ç•¥ï¼š
  ä¿ƒé”€ç­–ç•¥ï¼šåŸä»·
  æœ€ç»ˆä»·æ ¼ï¼š299.00å…ƒ | æ€»ä¼˜æƒ ï¼š0.00å…ƒ | æŠ˜æ‰£ç‡ï¼š0.0%

2. æ»¡å‡åˆ¸ï¼ˆæ»¡200å‡30ï¼‰ï¼š
  ä¿ƒé”€ç­–ç•¥ï¼šåŸä»· + æ»¡200å‡30
  æœ€ç»ˆä»·æ ¼ï¼š269.00å…ƒ | æ€»ä¼˜æƒ ï¼š30.00å…ƒ | æŠ˜æ‰£ç‡ï¼š10.0%

3. æŠ˜æ‰£åˆ¸ï¼ˆ8.5æŠ˜ï¼‰ï¼š
  ä¿ƒé”€ç­–ç•¥ï¼šåŸä»· + 8.5æŠ˜
  æœ€ç»ˆä»·æ ¼ï¼š254.15å…ƒ | æ€»ä¼˜æƒ ï¼š44.85å…ƒ | æŠ˜æ‰£ç‡ï¼š15.0%

--- åœºæ™¯2ï¼šä¼˜æƒ åˆ¸å åŠ ä½¿ç”¨ ---
æ–¹æ¡ˆ1ï¼šå…ˆæŠ˜æ‰£(8.5æŠ˜) + åæ»¡å‡(æ»¡200å‡30)
  ä¿ƒé”€ç­–ç•¥ï¼šåŸä»· + 8.5æŠ˜ + æ»¡200å‡30
  æœ€ç»ˆä»·æ ¼ï¼š224.15å…ƒ | æ€»ä¼˜æƒ ï¼š74.85å…ƒ | æŠ˜æ‰£ç‡ï¼š25.0%

æ–¹æ¡ˆ2ï¼šå…ˆæ»¡å‡(æ»¡200å‡30) + åæŠ˜æ‰£(8.5æŠ˜)
  ä¿ƒé”€ç­–ç•¥ï¼šåŸä»· + æ»¡200å‡30 + 8.5æŠ˜
  æœ€ç»ˆä»·æ ¼ï¼š228.65å…ƒ | æ€»ä¼˜æƒ ï¼š70.35å…ƒ | æŠ˜æ‰£ç‡ï¼š23.5%

=== ä¼˜æƒ åˆ¸è£…é¥°å™¨æ¨¡å¼æ€»ç»“ ===
âœ“ ä¼˜æƒ åˆ¸å¯ä»¥ä»»æ„å åŠ ç»„åˆ
âœ“ è®¡ç®—é¡ºåºå½±å“æœ€ç»ˆä»·æ ¼
âœ“ ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œæ˜“äºæ‰©å±•æ–°åˆ¸ç§
âœ“ é¿å…äº†ç»„åˆçˆ†ç‚¸é—®é¢˜
```

**è¾“å‡ºç‰¹ç‚¹ï¼š**
- æ¸…æ™°ç®€æ´ï¼Œæ— é‡å¤ä¿¡æ¯
- æ¯ä¸ªç­–ç•¥åªè¾“å‡ºä¸€æ¬¡è®¡ç®—ç»“æœ
- å®Œæ•´å±•ç¤ºä¿ƒé”€ç­–ç•¥ç»„åˆ
- ç›´è§‚æ˜¾ç¤ºæœ€ç»ˆä»·æ ¼ã€æ€»ä¼˜æƒ å’ŒæŠ˜æ‰£ç‡

## ğŸš€ å®é™…åº”ç”¨åœºæ™¯

### 1. ç”µå•†è´­ç‰©è½¦ç»“ç®—
```java
// æ ¹æ®ç”¨æˆ·é€‰æ‹©çš„ä¼˜æƒ åˆ¸è®¡ç®—æœ€ç»ˆä»·æ ¼
IPromotionStrategy strategy = new OriginalPrice();
for (Coupon coupon : user.getSelectedCoupons()) {
    strategy = coupon.createDecorator(strategy);
}
double finalPrice = strategy.calculatePrice(cartTotal);
```

### 2. è¥é”€æ´»åŠ¨ç®¡ç†
```java
// æ ¹æ®æ´»åŠ¨è‡ªåŠ¨å åŠ ä¼˜æƒ åˆ¸
IPromotionStrategy strategy = new OriginalPrice();
if (isDouble11Event()) {
    strategy = new DiscountCoupon(strategy, 0.8);  // åŒ11é¢å¤–8æŠ˜
}
if (isNewUser()) {
    strategy = new DirectReductionCoupon(strategy, 20);  // æ–°ç”¨æˆ·å‡20å…ƒ
}
```

### 3. ä¼šå‘˜ç­‰çº§ä½“ç³»
```java
// æ ¹æ®ä¼šå‘˜ç­‰çº§åº”ç”¨ä¸åŒæŠ˜æ‰£
IPromotionStrategy strategy = new OriginalPrice();
switch (user.getLevel()) {
    case GOLD:
        strategy = new DiscountCoupon(strategy, 0.85);
        break;
    case PLATINUM:
        strategy = new DiscountCoupon(strategy, 0.8);
        strategy = new DirectReductionCoupon(strategy, 10);
        break;
}
```

## âœ¨ è£…é¥°å™¨æ¨¡å¼åœ¨ä¼˜æƒ åˆ¸ç³»ç»Ÿä¸­çš„ä¼˜åŠ¿

### 1. **ç»„åˆçµæ´»æ€§**
- ä»»æ„å¤šç§ä¼˜æƒ åˆ¸å¯ä»¥å åŠ ä½¿ç”¨
- ç»„åˆé¡ºåºå¯ä»¥çµæ´»è°ƒæ•´
- æ”¯æŒåŠ¨æ€æ·»åŠ æˆ–ç§»é™¤ä¼˜æƒ åˆ¸

### 2. **æ‰©å±•æ€§å¼º**
- æ–°å¢ä¼˜æƒ åˆ¸ç±»å‹æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 
- ç¬¦åˆå¼€é—­åŸåˆ™
- æ˜“äºç»´æŠ¤å’Œæµ‹è¯•

### 3. **ä¸šåŠ¡é€»è¾‘æ¸…æ™°**
- æ¯ä¸ªä¼˜æƒ åˆ¸ç±»èŒè´£å•ä¸€
- è®¡ç®—é€»è¾‘å°è£…åœ¨å„è‡ªçš„ç±»ä¸­
- ä¾¿äºç†è§£å’Œä¿®æ”¹

### 4. **æ€§èƒ½è€ƒè™‘**
- é¿å…äº†å¤§é‡çš„å­ç±»åˆ›å»º
- è¿è¡Œæ—¶åŠ¨æ€ç»„åˆï¼Œå†…å­˜æ•ˆç‡é«˜

## ğŸ¯ æ€»ç»“

ä¼˜æƒ åˆ¸è£…é¥°å™¨æ¨¡å¼å±•ç¤ºäº†è®¾è®¡æ¨¡å¼åœ¨å®é™…ä¸šåŠ¡ä¸­çš„å¼ºå¤§åº”ç”¨ä»·å€¼ï¼š

- **è§£å†³äº†ç»„åˆçˆ†ç‚¸é—®é¢˜**ï¼š4ç§ä¼˜æƒ åˆ¸ä»16ä¸ªç»„åˆç±»å‡å°‘åˆ°6ä¸ªç±»
- **æä¾›äº†ä¸šåŠ¡çµæ´»æ€§**ï¼šæ”¯æŒä»»æ„é¡ºåºçš„ä¼˜æƒ åˆ¸ç»„åˆ
- **ç¬¦åˆè®¾è®¡åŸåˆ™**ï¼šéµå¾ªå¼€é—­åŸåˆ™ï¼Œæ˜“äºæ‰©å±•
- **è´´è¿‘å®é™…ä¸šåŠ¡**ï¼šå®Œç¾åŒ¹é…ç”µå•†ä¼˜æƒ åˆ¸çš„å åŠ ä½¿ç”¨åœºæ™¯

é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è£…é¥°å™¨æ¨¡å¼ä¸ä»…æ˜¯ä¸€ç§ç†è®ºè®¾è®¡æ¨¡å¼ï¼Œæ›´æ˜¯è§£å†³å®é™…ä¸šåŠ¡é—®é¢˜çš„å¼ºå¤§å·¥å…·ã€‚åœ¨éœ€è¦åŠ¨æ€ç»„åˆå¤šç§åŠŸèƒ½çš„åœºæ™¯ä¸­ï¼Œè£…é¥°å™¨æ¨¡å¼å¾€å¾€èƒ½æä¾›ä¼˜é›…è€Œé«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚